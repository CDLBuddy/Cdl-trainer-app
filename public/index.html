<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>CDL Trainer</title>
  <link rel="stylesheet" href="style.css" />

  <!-- =======================
       GLOBAL DEBUG SETTINGS
       ======================= -->
  <!-- EARLY DEBUG: Show alert + change bg color to prove JS runs -->
  <script>
    alert("🟢 Inline JS ran!");
    document.body.style.background = "#f00"; // Red if this JS runs!
  </script>
  <script>
    // Toggle dev/debug options here!
    window.APP_DEBUG = {
      htmlAlerts: true,        // Pop up alert when HTML loads
      moduleAlerts: true,      // Pop up alert when inline module runs
      fetchTest: true,         // Test fetch of app.js
      globalErrors: true,      // Show alerts for JS errors/rejections
      verboseLogs: false,      // Console log trace points (can alert if true)
      navTracer: false,        // Trace navigation/page loads
      authEvents: false,       // Log auth/user events
      featureFlags: true,      // Toggle feature-flag logic in-app
      simulateLatency: false,  // Simulate slow network for loader testing
    };
    window.FEATURE_BILLING_V2 = window.APP_DEBUG.featureFlags; // Example flag
  </script>
  <script>
    // DEV/DEBUG HOOKS
    const D = window.APP_DEBUG || {};
    // Pop up HTML loaded alert
    if (D.htmlAlerts) alert("✅ HTML loaded");
    // Pop up when DOM is ready/module loaded
    if (D.moduleAlerts) window.addEventListener('DOMContentLoaded', () => alert("🧪 Inline module is running!"));
    // Test if app.js fetches cleanly
    if (D.fetchTest) {
      fetch('app.js').then(r => alert("🔍 fetch app.js → " + r.status)).catch(e => alert("❌ fetch error: " + e.message));
    }
    // Global error trapping (disable in production)
    if (D.globalErrors) {
      window.addEventListener("error", e => alert("🚨 Global Error: " + e.message));
      window.addEventListener("unhandledrejection", e => alert("🚨 Promise Rejection: " + e.reason));
    }
    // (Optional) Console log/trace upgrades
    if (D.verboseLogs) {
      const oldLog = console.log;
      console.log = function (...args) {
        oldLog.apply(console, args);
        alert("[console.log] " + args.join(' '));
      };
    }
  </script>
</head>
<body>
  <!-- Initial Boot Loader (ALWAYS first, always present!) -->
  <div id="app-loader">
    <div class="loader-logo glow-shimmer">🚛 CDL&nbsp;Trainer</div>
  </div>

  <!-- App Content Mount Point: all dynamic app pages render here -->
  <div class="screen-wrapper">
    <div class="chatbot-container" id="app">
      <!--
        IMPORTANT: 
        All your JS page renders (renderHome, renderLogin, renderDashboard, etc)
        should now inject content wrapped like this:

        <div class="centered-page">
          <div class="main-card">
            <!-- Your page content here (dashboard, login, profile, etc) -->
          </div>
        </div>
      -->
    </div>
  </div>

  <!-- Page Transition Loader -->
  <div id="page-loader" class="loader-overlay hidden">
    <div class="truck-spinner">
      <div class="truck-body">🚛</div>
      <div class="trailers">
        <div class="trailer"></div>
        <div class="trailer"></div>
      </div>
    </div>
  </div>

  <!-- Animated Dots Loader (for extra polish, can remove later) -->
  <div class="dots"><span></span><span></span><span></span></div>

  <!-- ==== DEV/DEBUG/UTILITIES - Optional for Future ==== -->
  <script>
    // Usage: await window.simulateNetworkLatency(1200) in async functions
    window.simulateNetworkLatency = function (ms = 1200) {
      return (window.APP_DEBUG && window.APP_DEBUG.simulateLatency)
        ? new Promise(res => setTimeout(res, ms))
        : Promise.resolve();
    };
    // Example: Navigation tracer
    window.traceNavigation = function(page, ...args) {
      if ((window.APP_DEBUG||{}).navTracer)
        console.info("[Navigation Trace]", { page, args });
    };
    // Example: Auth event logger
    window.logAuthEvent = function(event, data) {
      if ((window.APP_DEBUG||{}).authEvents)
        console.info("[Auth Event]", event, data);
    };
  </script>

  <!-- Main App Entry (keep as type=module!) -->
  <script type="module" src="app.js"></script>

  <!-- Fallback Loader Debug: Show if JS fails to render the app -->
  <script>
    setTimeout(() => {
      const loader = document.getElementById('app-loader');
      if (loader && !loader.classList.contains('hide')) {
        loader.classList.add('hide');
        const appEl = document.getElementById('app');
        if (appEl && !appEl.innerHTML.trim()) {
          appEl.innerHTML = '<h2 style="color:white; text-align:center; margin-top:2em;">App loaded fallback!<br><span style="font-size:1.1em;color:#a3e063;">(No JS render)</span></h2>';
        }
      }
    }, 3000);
  </script>
</body>
</html>